# Small Todo App with Rails and ReactJS using Docker Compose

## Running the Application

Let's start the Todo first:

```bash
docker-compose up --build
```
frontend http://localhost:3001.

backend http://localhost:3000.

## Creating a New Rails Application with Docker without any ruby on machine

### Step 1: Set Up the Project Folder
Open a terminal and create a new folder for your project:

```bash
mkdir my-docker-compose-practise
cd my-docker-compose-practise
mkdir backend
cd backend
```

### Step 2: Docker Setup
Once inside the new folder, we create the file Dockerfile with a minimal setup to create an image that supports Ruby:

```bash
touch Dockerfile
```

Dockerfile:
```
FROM ruby:3.2.3

WORKDIR /app
```
Before building the new Docker image, letâ€™s create a file named `docker-compose.yml` with the following content:


```
version: '3.8'

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    volumes:
      - ./backend:/app
```

The file above sets up a container called backend that exposes the port 3000 (the port used by Rails) and sets up a volume that mounts the current path of the host machine to the folder /app in the container.

The volume is essential so that when we generate the Rails application in the container, the template files will persist in the host filesystem.

### Step 2: Generate a Rails application
Now we can go ahead and access the terminal of the container while exposing the service ports so we can access the Rails application later on via localhost:3000:

```
docker-compose run --service-ports backend bash
```

Once inside the container, we can install Rails and generate a new application:


```
gem install rails
rails new .
```
After running these commands, you should see all the files generated by Rails in the project folder.

### Step 4: Start the application
Next, we can start our Rails application using the option -b to bind the webserver to the correct IP address.

```
rails s -b 0.0.0.0
```

### Step 5: Install project dependencies when building the Docker image

After creating a new Rails app inside a Docker container, starting the server only works within the same session. To fix this, update Dockerfile to install Rails and dependencies during the build process, ensuring they persist between sessions

```
FROM ruby:3.2.3

RUN apt-get update -qq && apt-get install -y nodejs yarn

WORKDIR /app

COPY . .
RUN bundle install
```

### Step 6: Set up a default command for the main container
Define a command in your Docker Compose configuration to start the Rails application automatically using docker-compose up. After setting this up, running docker-compose up on your host machine will launch the Rails app, accessible at localhost:3000.

```
version: '3.8'

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    volumes:
      - ./backend:/app
    command: rails s -b 0.0.0.0
    depends_on:
      - db
    environment:
      DATABASE_URL: postgres://postgres:postgres@db:5432/postgres
  db:
    image: postgres:latest
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - "5432:5432"
```

---
## Docker Compose Addition for Frontend
Now, integrating the frontend service into your existing Docker Compose configuration:

### Step 1: Set Up the frontend Folder

```
npx create-react-app frontend
```

### Step 2: Docker Setup

```
cd frontend
touch Dockerfile
```
Dockerfile:
```
FROM node:22

WORKDIR /app

COPY package*.json ./

RUN npm install

COPY . .

RUN npm run build

EXPOSE 3000

CMD ["npm", "start"]

```
final docker-compose:
```
version: '3.8'

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    volumes:
      - ./backend:/app
    command: rails s -b 0.0.0.0
    depends_on:
      - db
    environment:
      DATABASE_URL: postgres://postgres:postgres@db:5432/postgres
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "3001:3000"
    volumes:
      - ./frontend:/app
    command: npm start
    environment:
      - NODE_ENV=development
  db:
    image: postgres:latest
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - "5432:5432"
```

